##

#rename
```
sudo mv HX_Cm_T55_G6_scaffolds.fasta /home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_Cm_T55_G6/


sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/GD/GD2_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/GD/GDScaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/GD_Cm_T35_P1/G35_1_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/GD_Cm_T35_P1/GDCmT35P1Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/GD_Cm_T35_P2/G35_2_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/GD_Cm_T35_P2/GDCmT35P2Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/GD_Cm_T35_P3/G35_3_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/GD_Cm_T35_P3/GDCmT35P3Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_Cm_T55_B3/KD55_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_Cm_T55_B3/HXCmT55B3Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_Cm_T55_G6/HX_Cm_T55_G6_scaffolds.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_Cm_T55_G6/HXCmT55G6Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_O_T35/J35_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_O_T35/HXOT35Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_O_T45/J14-J15_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_O_T45/HXOT45Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_O_T55/J20_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_O_T55/HXOT55Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_O_T65/J65_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/HX_O_T65/HXOT65Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/SK0/scaffolds.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/SK0/SK0Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/SK1/scaffolds.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/SK1/SK1Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/SK2/scaffolds.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/SK2/SK2Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/SK3/scaffolds.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/SK3/SK3Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY/XL1_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY/XYScaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C16_T55_B1/C16-4_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C16_T55_B1/XYC16T55B1Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C16_T55_B2/C16-2_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C16_T55_B2/XYC16T55B2Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C16_T55_CK/C16-CK_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C16_T55_CK/XYC16T55CKScaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C20_T55_P1/2-C20-4_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C20_T55_P1/XYC20T55P1Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C20_T55_P2/2-C20-8_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C20_T55_P2/XYC20T55P2Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C30_T55/C30_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_C30_T55/XYC30T55Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_O_T55_M1/w55_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_O_T55_M1/XYOT55M1Scaf.fasta
sudo mv /home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_O_T55_M2/pw55_scaffold.fasta	/home/PTPE2/Project/mlp_data_liupengfei/metaG/XY_O_T55_M2/XYOT55M2Scaf.fasta
```

#
```
cd /home/PTPE2/User/liupf/Projects_liupf/mlp_oil_virus/scaffolds10k


for file in $(cat contigs.list)
do

echo "${file}"
cp "${file}" ./

#seqkit seq -m 10000 ${file}  >/home/PTPE2/User/liupf/Projects_liupf/mlp_oil_virus/scaffolds10k/"${file%.*}"10k.fa

done


for file in *.fasta
do

echo "${file}" >> stats.contigs.txt
stats.sh "${file}"  >> stats.contigs.txt
seqkit seq -m 10000 ${file}  >/home/PTPE2/User/liupf/Projects_liupf/mlp_oil_virus/scaffolds10k/"${file%.*}"10k.fa

done

for file in *.fa
do
echo "${file}" >> stats.contigs10k.txt
stats.sh "${file}"  >> stats.contigs10k.txt
done
```

## fix sequences header
```
#
for file in *.fa
do
echo "${file%%.*}"

# NODE_1_length_2368885_cov_141.147283 ==> NODE_1_147283
#sed -i -e  "s/>\(NODE_.*\)_length.*cov_.*\.\(.*\)$/>"${file%%.*}"\1_\2/g" ${file}

#10kNODE_
sed -i -e  "s/10kNODE_//g" ${file}
done

#sed -i -e  "s/>\(k.*_.*\) flag.*$/>"${file%%.*}"_\1/g" ${file}
#sed -i -e  "s/>.*_\(Scaff.*\)$/>"${file%%.*}"_\1/g" ${file}
#sed -i -e  "s/contig_over10k//g" ${file}
#done

cat *.fa > MLP_oil10kscaf.fasta

#grep -c '>' MLP_oil10kscaf.fasta
#89150, checked

#copy to PTPE1
scp MLP_oil10kscaf.fasta ptpe@210.26.118.41:/home/PTPE1/User/liupf/Projects_liupf/mlp_oil_virus_project/


virsorter run -w MLP_oil10kscaf.out -i MLP_oil10kscaf.fasta  -j 60 --prep-for-dramv --min-length 10000 --include-groups dsDNAphage,NCLDV,RNA,ssDNA,lavidaviridae -d /home/PTPE2/User/liupf/test_data/db  all  &> MLP_oil10kscafâ€”vs2_all.log
```


#vibrant
#
```
cd /home/PTPE2/User/liupf/Projects_liupf/mlp_oil_virus/scaffolds10k

VIBRANT_run.py -i MLP_oil10kscaf.fasta -t 60 -l 10000

```


##deepvirfinder
```
cd /home/PTPE2/User/liupf/Projects_liupf/mlp_oil_virus/scaffolds10k

screen -S deepvirfinder
conda activate deepvirfinder
python /home/PTPE2/Software/DeepVirFinder/dvf.py -i MLP_oil10kscaf.fasta -o MLP_oil10kscaf_Deepvirfinder -l 10000 -c 20 #got stuck

python /home/PTPE2/Software/DeepVirFinder/dvf.py -i MLP_oil10kscaf.fasta -o MLP_oil10kscaf_Deepvirfinder -l 10000 -c 60 &>dvf.log


#try on PTPE1
source /home/PTPE1/Software/miniconda3/bin/activate
conda activate deepvirfinder
/home/PTPE1/User/liupf/Projects_liupf/mlp_oil_virus_project
python /home/PTPE1/Software/DeepVirFinder/dvf.py -i MLP_oil10kscaf.fasta -o MLP_oil10kscaf_Deepvirfinder -l 10000 -c 30
INFO (theano.gof.compilelock): To manually release the lock, delete /home/ptpe/.theano/compiledir_Linux-3.10-el7.x86_64-x86_64-with-centos-7.9.2009-Core-x86_64-3.6.13-64/lock_dir

#failed !!

#split into 100 seqs perfile
seqkit split2 MLP_oil10kscaf.fasta -s 80 -f

for file in *.fasta
do
python /home/PTPE1/Software/DeepVirFinder/dvf.py -i ${file} -o "${file%.*}"_out -l 10000 -c 30
done

#round 1
for file in *.fasta
do
echo "nohup python /home/PTPE1/Software/DeepVirFinder/dvf.py -i ${file} -o "${file%.*}"_out -l 10000 -c 10 &" >> nohup.1000.sh
echo "sleep 30s" >> nohup.1000.sh
done

#round_dvf.txt
cat round_dvf.txt|grep -v 'name' |cut -f1 -d$'\t'|sort|uniq > round1_dvf_seq_finished.txt
63639
#get unrun samples

seqkit grep round1_dvf_seq_finished.txt MLP_oil10kscaf.fasta
seqkit grep -n -v -f round1_dvf_seq_finished.txt MLP_oil10kscaf.fasta -o MLP_oil10kscaf_round2.fasta
25511


#round 2
for file in *.fasta
do
echo "nohup python /home/PTPE1/Software/DeepVirFinder/dvf.py -i ${file} -o "${file%.*}"_out -l 10000 -c 10 &" >> nohup.1000.sh
echo "sleep 30s" >> nohup.1000.sh
done
sh ./nohup.1000.sh

for file in *_out
do
cat ./"${file}"/*.txt >> ../round2_dvf.txt
done
cat round2_dvf.txt|grep -v 'name' |cut -f1 -d$'\t'|sort|uniq > round2_dvf_seq_finished.txt
#25504

cat round2_dvf_seq_finished.txt round1_dvf_seq_finished.txt > round12_dvf_seq_finished.txt
seqkit grep -n -v -f round12_dvf_seq_finished.txt MLP_oil10kscaf.fasta -o MLP_oil10kscaf_round3.fasta

nohup python /home/PTPE1/Software/DeepVirFinder/dvf.py -i MLP_oil10kscaf_round3.fasta -o MLP_oil10kscaf_round3_out -l 10000 -c 10 &
```

#virfinder
```
conda activate virfinder
R
library(VirFinder)

predResult <- VF.pred("./MLP_oil10kscaf.fasta")

predResult[order(predResult$pvalue),]
predResult$qvalue <- VF.qvalue(predResult$pvalue)
predResult_sorter<-predResult[order(predResult$qvalue),]

write.table(predResult_sorter, file="virfinder-LP_oil10kscaf.txt", quote=F, sep="\t")

awk '$4>0.9&&$5<0.05' virfinder-metaG10.txt |wc -l
#401
awk '$4>0.7&&$5<0.05' virfinder-metaG10.txt |wc -l
#892
virfinder-metaG10.txt
```
